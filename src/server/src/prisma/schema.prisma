datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_CONNECTION_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-arm64-openssl-3.0.x"]
}

model User {
  id           String      @id @default(uuid())
  username     String      @unique
  email        String      @unique
  role         Role
  orgName      OrgName
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  // Relations
  issuedDocuments   Document[] @relation("Issuer")
  receivedDocuments Document[] @relation("IssuedTo")
  requests          Request[]  @relation("Requester")
}

model Document {
  id               String         @id @default(uuid())
  issuedTo         String
  issuer           String
  fileData         Bytes?         // Store as binary
  status           DocumentStatus @default(issued)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  
  // New academic detail fields
  degreeTitle      String?        // e.g., "Bachelor of Science"
  fieldOfStudy     String?        // e.g., "Computer Science" 
  graduationDate   DateTime?      // When the degree was earned
  honors           String?        // e.g., "Cum Laude", "First Class"
  studentId        String?        // Student's university ID
  programDuration  String?        // e.g., "4 years"
  gpa              Float?         // Grade Point Average
  additionalNotes  String?        // Any additional information

  // Relations
  issuerUser    User      @relation("Issuer", fields: [issuer], references: [id])
  issuedToUser  User      @relation("IssuedTo", fields: [issuedTo], references: [id])
  requests      Request[] @relation("Document")
}

model Request {
  id          String    @id @default(uuid())
  requesterId String
  documentId  String
  status      RequestStatus @default(pending)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  requester User     @relation("Requester", fields: [requesterId], references: [id])
  document  Document @relation("Document", fields: [documentId], references: [id])
}

model WalletIdentity {
  label       String   @id
  orgName     OrgName
  type        String   // e.g., "X.509"
  certificate String   @db.Text
  privateKey  String   @db.Text
  mspId       String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([label, orgName])
}

enum Role {
  university
  individual
  employer
}

enum OrgName {
  orguniversity
  orgindividual
  orgemployer
}

enum DocumentStatus {
  issued
  accepted
  denied
}

enum RequestStatus {
  pending
  granted
  denied
}
